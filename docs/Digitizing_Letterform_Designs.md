# 数字化字体设计

## 介绍

本章概述了数字化字形的主要注意事项：数字化 TrueType 格式的字形设计。 [TrueType 字体文件](/FontTables/FontTables.html)中，TrueType 字形轮廓在字体文件中表示的格式的完整规范。

## 点

在最低层，TrueType 字体中的每个字形都由网格上的一系列点来描述。虽然两个曲线上点足以描述一条直线，但在两个曲线上点之间添加第三个曲线外点可以描述抛物线。在这种情况下，每个曲线上点代表曲线的终点，曲线外点是控制点。更改三个点中任何一个的位置都会更改定义的曲线的形状。

<!-- （这句话可能不是很好理解，看下面的图片，点<cite>p<sub>0</sub></cite>和点 <cite>p<sub>2</sub></cite> 都可以看做这条曲线的终点。） -->
<!-- <cite>p<sub>0</sub></cite> -->
<!-- <cite>p<sub>1</sub></cite> -->
<!-- <cite>p<sub>2</sub></cite> -->
这种曲线的定义可以正式如下：给定三个点 <cite>p<sub>0</sub></cite>、<cite>p<sub>1</sub></cite>、<cite>p<sub>2</sub></cite>，它们定义了一条从点 <cite>p<sub>0</sub></cite> 到点 <cite>p<sub>2</sub></cite> 的曲线，其中 <cite>p<sub>1</sub></cite> 是偏离曲线的点。 控制点 <cite>p<sub>1</sub></cite> 位于曲线的切线在点 <cite>p<sub>0</sub></cite> 和 <cite>p<sub>2</sub></cite> 的交点处。 因此 <cite>p<sub>0</sub></cite>, <cite>p<sub>1</sub></cite> 在点 <cite>p<sub>0</sub></cite> 处与曲线相切。 类似地，<cite>p<sub>2</sub></cite>，<cite>p<sub>1</sub></cite> 在点 <cite>p<sub>2</sub></cite> 处与曲线相切。 这三个点指定的曲线由参数方程定义。 对于 0 到 1 的 t，p(t) 的位置如图所示：

<center>p(t) = (1-t)<sup>2</sup><cite>p<sub>0</sub></cite> + 2t(1-t)<cite>p<sub>1</sub></cite> + t<sup>2</sup><cite>p<sub>2</sub></cite></center>

以上描述的曲线是贝塞尔二次曲线。 二次曲线如图 1 所示：

![二次曲线](./images/fig01.jpeg)

**图1**

由三个控制点定义的二次曲线。

本质上是抛物线的曲线可以用一条二次曲线来表示。 更复杂的曲线可以用几条相连的曲线来表示。 这些组件的切线连续连接产生二次样条。 当曲线以它们的共享点具有相同切线的方式连接时，就会发生这种连接。

如果每个曲线点都在连接两个侧翼控制点的线上，则连接的二次曲线具有一阶连续性和切线连续性。

这样的曲线如图 2 所示。这里两条曲线 p0、p1、p2 和 p2、p3、p4 在它们的公共点 p2 处连接。 请注意，在图中，点 p1、p2 和 p3 是共线的。

![二次曲线2](./images/fig02.jpeg)

**图 2**

二次曲线共享一个共同的曲线上点

也可以通过删除点 p2 来指定图 2 中所示的曲线少一个点。 点 p2 不是严格定义曲线所必需的，因为它暗示了它的存在，并且它的位置可以从其他点给出的数据中重建。 对剩余点重新编号后，我们得到了图 3 所示的曲线。

![二次曲线3](./images/fig03.jpeg)

**图 3**

具有隐含曲线上点的二次曲线

通过组合曲线和直线，可以构建复杂的字形。 这种字体如下图 4 所示。 定义字形的曲线上点显示为黑色小圆圈。 偏离曲线点显示为小的空心圆圈。

![二次曲线4](./images/fig04.gif)

**图 4**

带有曲线上和曲线外点的字形轮廓

## 轮廓

在相对简单的字形中，例如图 4 中所示的字母 c，定义字形的点序列组合起来形成称为轮廓的闭合形状。 在更复杂的字形中，例如下图 5 中所示的字母 B，点序列定义了三个不同的闭合形状，每个都是轮廓。

![二次曲线5](./images/fig05.gif)

**图 5**

具有三个轮廓的字形轮廓

从这些例子可以推断，字形可以有零个或多个轮廓。 （字形空间有一个提前宽度但没有其他可见的表现形式，其轮廓为零。）

### 轮廓方向：

在定义轮廓时，字体制造商必须遵循许多规则。 轮廓中的点必须从第一个轮廓点 0 开始连续排序。后续轮廓将从第一个未使用的数字开始。 必须按照字体文件中指定的顺序从一个点到另一个点来描述每个轮廓。

指定点的顺序很重要，因为它决定了轮廓的方向。 方向始终是从较低的点数向较高的点数。

字形轮廓的方向用于确定轮廓定义的形状的哪些部分是填充的（黑色），哪些部分是未填充的（白色）。

在进行此确定时，TrueType 使用非零绕组数规则（the non-zero winding number rule）。 有关应用此规则的信息，请参阅[区分字形的内部和外部(字体引擎)](./Font_Engine.md)。

### 相交轮廓：

TrueType 允许两个轮廓相交的可能性。 此功能可以方便地描述字母的轮廓，例如 Q。在这种情况下，将调用非零缠绕数规则（the non-zero winding number rule）来确定适当的填充。 当放置在其他黑色填充区域上时，黑色填充区域将保持黑色。 下面的图 6 显示了这种效果的一个示例。

![二次曲线6](./images/fig06.gif)

**图 6**

重叠轮廓

### 复合字形：

通常将字体中的一些字形组合起来以产生新的字形很方便。 这通常用于在字体同时包含基本字符和重音字符的情况下生成重音字符。 TrueType 通过复合字形机制允许这些组合。 图 7 显示了一些可能以这种方式创建的字形。

![二次曲线7](./images/fig07.gif)

**图 7**

组件字形

复合字形由基础字形和添加以产生新字形的第二个字形组成。 新的字形结合了这两个组件来创建新的复合形式。 如果需要，可以使用两个以上的组件创建字形。

## 复合字形放置

为了帮助相对于基本字形放置附加字形，必须提供指定后续字形相对于第一个字形中的点的偏移量的信息。

组合成复合字形的每个字形可以按不同的量进行缩放。 这可能很有用，例如，通过组合分数字形和两个数字来创建分数。

组成复合字形的每个字形都可以有相关的指令。 复合字形作为一个整体也可以有指令。

复合字形规范的详细描述在[复合字形](./FontTables/'glyf'.md)中给出。

## 主网格

构成字形轮廓规范的点位于网格上，其单位不可分割，大小由字体创建者定义。 这些单位被称为字体单位。

网格是一个二维坐标系，其 x 轴描述水平方向的移动，y 轴描述垂直方向的移动。 网格原点的坐标为 (0,0)。 网格：sizegrid 不是无限平面。 每个点必须在 -16384 到 +16383 字体单位的范围内。

在创建字形轮廓时，字体创建者使用了一个源自 em 正方形的旧版式概念的假想正方形。 这个方格可以被认为是一个在其上绘制字符的数位板，尽管字符可以超出数位板或 em 方格。 字体单元的大小相对于 em 方格的大小决定了网格的粒度。 换句话说，网格的分辨率是每个 em 字体单元数的函数。

每个 em 的字体单元数越多，可以在字体文件中表示的设计就越微妙。 在确定什么是合适的网格粒度时，字体设计者应该考虑潜在输出设备的最大分辨率，并考虑到数据转换中可能出现的精度损失。 如果每个 em 的单位是 2 的幂，则轮廓缩放将最快。 例如，Apple 核心字体设计在每 em 2048 个单位的网格上。

图 8 显示了两个不同的网格。 左边的网格不能代表字母 A 原始设计的微妙之处。右边的网格，每个 em 的单位数是四倍，更接近，尽管需要更精细的粒度才能忠实地呈现原始设计。

![二次曲线8](./images/fig08.gif)

**图 8**

定义主外轮廓。

## 在网格中放置字形

定义字形形状的坐标也决定了字形相对于坐标网格的位置。 虽然没有正式要求字形与网格具有一致的关系，但在实践中，应用程序依赖于某些约定的存在来帮助文本布局。

在旨在水平布局的罗马字体中，0 的 y 坐标通常对应于字体的基线。 没有标准含义与 x 坐标 0 相关联，但如果字体代工厂选择标准含义，应用程序将受益。 一个常见的约定是放置字形原点，以便字形左边缘的值等于左侧方位角。 此选项如图 9 所示。也可以将字形的美学中心放置在 x 轴上，如图 10 所示。

![二次曲线9](./images/fig09.gif)

**图 9**

字形的左侧方位角是 x 零。

![二次曲线10](./images/fig10.gif)

**图 10**

字形的美学中心是 x 零。

非罗马字体可能希望对 x 轴和 y 轴的含义使用其他约定。 然而，为了与突出显示和插入符号进行良好的交互，希望字符的主体大致位于前进宽度的中心。 例如，对称字符应该具有相等的左右侧方位。 例如，一个字形可能被放置在其美学中心位于 x 坐标值 0 处。放置在一个列中的字形使得它们的 x 坐标值 0 重合在渲染时将看起来很好地居中。 此选项可用于汉字或其他垂直排版的字体。 图 11 显示了这种放置的一个示例。

![二次曲线11](./images/fig11.gif)

**图 11**

在字形的美学中心带有 x 零的汉字字符

另一种选择是放置每个字形，使其最左边的轮廓点的 x 值等于字形的左侧方位。

虽然在铅字印刷时代，字形不能超出 em 方格，但数字字体并没有像图 12 所示那样受到限制。em 方格可以做得足够大，以完全包含字体中的所有字形，包括重音字形 . 或者，如果证明方便的话，部分字形可能会延伸到 em 方格之外。 由于 TrueType 字体可以处理任何一种方法，因此选择取决于字体设计者的偏好。