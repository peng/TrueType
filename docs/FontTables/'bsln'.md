# "bsln" 表

## 介绍

基线表(baseline)（标签名称：'bsln'）允许您设计 AAT 字体以适应文本与不同基线的自动对齐。 所有字体都有一个自然基线，该基线由字体em-square中每个字形的位置定义。 AAT 字体可以包括标识字形可以对齐的其他基线位置的附加信息。

可以包括表示罗马基线、表意基线（居中或降低）、悬挂基线和数学基线的基线位置。

基线表中包含两种信息： 基线位置，允许对齐文本串； 和基线值，对于字体中的每个字形，标识哪个基线位置是其默认基线位置。 在包含多种语言（例如英语和日语）字形的字体中，基线值可以识别哪些字形属于哪些默认基线位置——英语字形属于罗马默认基线，日语字形属于表意居中默认基线。

有 32 个预定义的基线值。 应为所有水平 AAT 字体提供值为 0 到 4 的基线。 剩余的值保留供将来使用：

|值|描述|
|-|-|
|0| 罗马基线。 这定义了大多数拉丁脚本语言中使用的对齐方式，其中大部分字形位于基线之上，部分（例如下降部分）可能位于基线之下。 基线出现在整条线的底部附近。
|1| 表意文字居中基线。 这定义了中文、日文和韩文表意文字所使用的行为，它们在行高的一半处居中。
|2| 表意文字低基线。 这也定义了中文、日文和韩文中使用的行为，与之前的值类似，但字形稍微降低，以便与拉丁字符相邻的表意文字看起来略低于罗马基线。
|3| 悬挂基线。 这定义了梵文和派生脚本中使用的对齐方式，其中大部分字形位于基线下方，某些部分可能位于基线上方，并且基线本身出现在行顶部附近。 该值也用于删除资本。
|4| 数学基线。 这定义了用于设置数学的对齐方式，其中像减号这样的运算符需要居中。 它通常设置为字体 x 高度的一半。

## 基线表格式

基线表由基线表头、默认基线以及包含特定于格式的基线数据的基于距离的数组（格式 0 或 1）或基于控制点的数组（格式 2 或 3）组成。 字体开发人员必须在使用基于距离的数据或基于控制点的数据之间进行选择。 任何一种字体中仅存在其中一种。 基线表的整体结构如下所示：

![ff26](./images/FF26.gif)

基线表格式如下：

|类型|名称|描述|
|-|-|-|
|fixed32|version| 基线表的版本号（当前版本为 0x00010000）。
|uint16|format| 基线表的格式。 只能为字体选择一种基线格式。
|uint16|defaultBaseline| 所有字形的默认基线值。 该值可以从 0 到 31。
|variable|parts| 特定于格式的数据。 这将是 Format0Part、Format1Part、Format2Part 或 Format3Part，具体取决于格式字段的值。

“bsln”表的格式字段有四个定义的值，并且与每个值相关联的是包含特定于格式的数据的记录。 基线表可以采用以下格式之一：

|值|描述|
|-|-|
|0| 基于距离，无映射。|
|1| 基于距离，带有地图。|
|2| 基于控制点，无映射。|
|3| 基于控制点，带有映射。|

根据格式字段的值，defaultBaseline 字段的值可能适用于字体的所有字形（格式 0 或 2），也可能仅适用于没有特定映射数据的字体字形（格式 1 和 3)。

格式 1 和格式 3 基线表使用查找表将基线值与特定字形关联起来。 这是如何解释五种查找表格式中每一种的查找值：

|查找格式|解释|
|-|-|
|0| 16 位基线值数组，一个对应字体中的每个字形。|
|2| 每个lookupSegment的值是一个16位的基线值。|
|4| 每个lookupSegment 的值是从查找表开头到16 位基线值数组的16 位偏移量，段中的每个字形都有一个偏移量。|
|6| 每个lookupSingle 的值是该字形的16 位基线值。|
|8| valueArray 是一个 16 位基线值的数组，一个对应于修剪数组中的每个字形。|

### 格式 0 基线表

格式 0 基线表对于字体中的所有字形都有一个默认基线值（标头的 defaultBaseline 字段）。 基线位置——从自然基线到给定基线的距离——以 FUnit 距离单位给出。 没有与此格式关联的映射表。 没有与此格式关联的查找表。 特定于格式的部分称为 Format0Part，并具有以下格式：

|类型|名称|描述|
|-|-|-|
|int16|deltas[]|这些是从字体的自然基线到字体中使用的其他基线的 FUnit 距离增量。 总共必须分配 32 个增量。|

### 格式 1 基线表

格式 1 基线表具有为字体中的所有字形指定的单个默认基线（defaultBaseline 字段）和一个允许字体中的不同字形具有不同主导基线的查找表。 映射表未涵盖的字形使用默认基线。 特定于格式的部分称为 Format1Part，并具有以下格式：

|类型|名称|描述|
|-|-|-|
|int16|deltas[]|这些是从字体的自然基线到字体中使用的其他基线的 FUnit 距离增量。 总共必须分配 32 个增量。|
|LookupTable|mappingData|将字形映射到其基线值的查找表。 有关查找值的解释，请参阅上文。|

### 格式 2 基线表

格式 2 基线表为字体中的所有字形指定一个默认基线值。 它还将字体中的一个特定字形（称为标准字形）指定为具有一组控制点。 将指令应用于该字形后，这些控制点定义基线位置。 没有与此格式关联的查找表。 特定于格式的部分称为 Format2Part，并具有以下格式：

|类型|名称|描述|
|-|-|-|
|uint16|	stdGlyph|	该字体中用于设置基线值的特定字形索引号。 这是标准字形。 该字形必须包含一组控制点（其编号包含在 ctlPoints 字段中），用于确定基线距离。|
|uint16|	ctlPoints[]|与标准字形关联的控制点编号集。 值 0xFFFF 表示标准字形中没有相应的控制点。 总共必须分配 32 个控制点。|

### 格式 3 基线表

格式3基线表为字体中的所有字形指定单个默认基线值，以及允许字体中的不同字形具有不同的指定默认基线的查找表。 它还指定字体中的一个特定字形（称为标准字形），因为它具有一组控制点，在提示后将用于定义基线位置。 特定于格式的部分称为 Format3Part，并具有以下格式：

|类型|名称|描述|
|-|-|-|
|uint16|	stdGlyph|此字体中字形的字形索引，用于设置基线值。 该字形必须包含一组确定基线距离的控制点（其编号包含在以下字段中）。|
|uint16|ctlPoints[]|32 个控制点编号的数组，与标准字形相关。 值 0xFFFF 表示标准字形中没有相应的控制点。|
|LookupTable|mappingData|将字形映射到其基线值的查找表。 有关查找值的解释，请参阅上文。|

## 基线表示例

### 示例：使用基线

您可以使用“bsln”表来定义字体内的多个基线。 在下图中，大写字形“D”位于全角方形中。 自然基线位于字体坐标中的 y = 0 处。 在没有任何其他信息的情况下，不同大小的该字形渲染与该线有共同之处——也就是说，笔将始终停留在该线上。 此示例使用距离格式。

![ff51](./images/FF51.gif)

下图显示第二条基线（标记为悬挂基线）已添加到第一条基线中。 罗马基线与字体的自然基线相同，因此两者之间的增量为零。 悬挂基线高于自然基线一定距离。 在该字体的坐标系中，“向上”指向更正的坐标，因此偏移是正值。

![ff52](./images//FF52.gif)

让我们看一个如何应用这些距离的示例。 在下图中，初始文本以三个不同大小的大写 D 字形开头。 用户指定前两个大写 D 字形应具有悬挂基线。
