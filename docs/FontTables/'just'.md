# "just"表
## 一般表信息
### 介绍
对齐表（标签名称：“just”）允许您设计 AAT 字体以适应特殊的对齐功能。 对齐是在印刷上拉伸或收缩一行文本以适合给定高度或宽度的过程。 一行文本是字形的集合，该行上的每个字形都与左右（或顶部和底部）宽度增量因子、对齐类别和对齐优先级相关联。

您可以选择许多不同的选项来控制字体中文本的对齐方式，包括以下选项：

* 任何字形左侧和右侧的单独对齐因素。
* 在需要放松线的情况以及需要收紧线的情况下，使用不同的调整因子集。
* Kashida 字形，用于连接连接脚本（例如阿拉伯语或草书罗马字）中其他字形的字形。
* 控制字形参与对齐过程的顺序。
* 选择“无限”的某些字形，以便它们在对齐过程中始终吸收所有剩余的间隙。
* 基于上下文的、基于状态表的对齐行为指定，因此相同的字形在不同的上下文中可能有完全不同的行为。
* 通过简单拉伸或使用字体变化机制，使字形改变形状以填充间隙（复制拟合）。
* 如果在对齐过程中添加了太多空白，则能够将连字撤回到其组成部分。

宽度增量因子是字形可以在每一侧扩展或收缩的分数测量值。 （对于某些脚本，字形的侧面位于左侧和右侧；对于其他脚本，它们位于顶部和底部。）您可以将宽度增量因子确定为相对于单点字形的距离（以点为单位测量）。 为了计算较大点大小的字形的宽度增量因子值，请将此距离乘以该点大小。 例如，右侧增长因子的宽度增量因子值为 2.5，这意味着可以将 2.5 点的空白添加到大小为 1 磅的字形右侧。 例如，如果 12 点字形的右侧增长宽度增量因子为 2.5，则可以将 30 点的空白添加到字形的右侧。 有些字形也被指定为无限的，这意味着它们占据了一行上的所有可用间隙。 例如，如果您不想添加字形间距，则可以将一个或多个空白字形指定为无限制。

对齐类别允许与字形一起使用的宽度增量因子集在线上的不同位置发生变化。 例如，字形可能会根据它出现在单词的开头还是结尾而表现出不同的行为。 允许字形在一行或一个单词的不同位置具有不同的宽度增量因子对于非罗马语言（例如阿拉伯语）尤其重要。 您包括一个对齐类别状态表，以便为字形分配适当的对齐类别。

对齐优先级标识字形开始参与对齐过程的阶段。 四个优先事项是：

* kashida 优先。 这是辩护期间的最高优先级。 首先处理具有此优先级的任何字形。 此优先级主要用于阿拉伯语，它标识要使用 kashida 扩展条扩展的字形，而不是通过添加空格来扩展。
* 空白优先。 这是下一个最高优先级。 您应该给予空白字形（如字形属性表中所标识）此优先级。
* 字形间优先级。 此优先级应用于任何剩余的字形。 此优先级的字形晚于前两个优先级的字形参与调整过程。
* null空优先级。 该优先级通常不包含在字体中； 相反，它被应用程序用来在文本布局时覆盖对齐优先级，因此不应用于字体中的任何实际字形。
对齐表存储字体字形和整个字体的对齐信息。 您可以存储水平和垂直调整或一个方向的调整。

### 原因表格式
调整表如图4-1所示。 该表以指向单独的水平和垂直对齐标题的整体表标题开始。 这些标题中的每一个都指向包含在水平或垂直方向上对齐字体所需的信息的子表。

图 4-1 调整表

![FF35](./images/FF35.gif)

对齐表的顶层包含表的版本号、对齐表的格式号以及水平和垂直对齐表的偏移量。 调整表的顶层格式如表 4-1 所示。

|类型|名称|描述|
|-|-|-|
|Fixed|version|调整表的版本号（当前版本为 0x00010000）。|
|UInt16|format|原因表的格式（设置为 0）。|
|UInt16|horizOffset|从调整表开头到表头的字节偏移量contain justification 水平文本的信息。 如果您不包含此信息，请存储 0。|
|UInt16|vertOffset|从调整表开头到表头的字节偏移量contain justification 垂直文本的信息。 如果您不包含此信息，请存储 0。|

您可以存储单独的表格，以获取有关字体如何处理水平对齐（而不是垂直对齐）的信息。 标头的 horizOffset 和 vertOffset 字段指向 JustificationHeader 类型的特定方向的对齐标头。 这些特定于方向的对齐标头包含表的偏移量，这些表描述了字体在对齐过程中所需的数据：对齐类别、字体的宽度增量因子和后补偿子表，这是一个可选表，允许您指定字体可以执行的对齐行为 特定情况下显示。 JustificationHeader的格式如下表所示：

|类型|名称|描述|
|-|-|-|
|UInt16|	justClassTableOffset|	调整类别状态表的偏移量。
|UInt16|	wdcTableOffset|	从对齐表开始到包含字体字形宽度增量因子的子表开始的偏移量。
|UInt16|	pcTableOffset|	从调整表开始到补偿后子表开始的偏移量（如果没有则设置为零）。
|variable|	lookupTable|	将字形与宽度增量簇关联起来的查找表。 有关如何解释查找值的详细信息，请参阅“宽度增量簇”表的说明。
|variable|	widthDeltaClusters|	宽度增量簇表。
|variable|	postcompTable|	后补偿子表（如果存在于字体中）。

### 理由类别状态表
对齐类别状态表允许您将字形与取决于字形上下文的对齐类别相关联。 状态表的格式如下：

|类型|名称|描述|
|-|-|-|
|MorphSubtableHeader|	morphHeader|变形风格的子表头。|
|StateHeader|	stHeader|调整插入状态表头|

对于该状态表，条目子表中的条目仅包括newState字段和flags字段； glyphOffsets 数组中没有值。 下表给出了该状态表的标志字段的解释：

|掩码值|姓名|解释|
|-|-|-|
|0x8000|	setMark|如果设置，则使当前字形成为标记字形。
|0x4000|	dontAdvance|如果设置，则在进入新状态之前不要前进到下一个字形。
|0x3F80|	markCategory|如果非零，则标记字形的对齐类别。
|0x007F|	currentCategory|当前字形的调整类别（如果非零）。
对齐类别是一个 7 位值，允许与该字形一起使用的因子集在线上的不同位置发生变化。 当分析一条线时，根据字形索引和上下文，为每个字形分配一个对齐类别。 通过这种方式，您可以在同一字形的对齐行为中提供细微的差异。 例如，单词末尾的小写“e”的行为可能与单词开头或中间的小写“e”不同。 然后，将此对齐类别与宽度增量记录相匹配，该记录包含字形增长和收缩的限制。

如果对齐类别字段（markCategory 和 currentCategory）非零，则它们用于设置相应字形的对齐类别。 如果设置了 setMark 标志，则会记住当前字形在字形数组中的位置，使其成为标记字形。

### 宽度增量Delta表
对齐类别的宽度增量因子存储在宽度增量簇中。 每个簇包含许多宽度增量对。 每对将一个对齐类别映射到一个宽度增量记录，其中包含有关您对该对齐类别中的字形增大和缩小的能力设置的限制的信息。

查找表用于查找与特定字形关联的宽度增量簇。 这是解释五种查找表格式中每一种的查找值的方法：

|查找表格式|解释|
|-|-|
0	16 位偏移量数组，每个偏移量对应字体中的每个字形。 每个偏移量是从宽度增量簇表的开始到该字形的特定宽度增量簇。
2	每个lookupSegment的值是从宽度增量簇表的开始到该段中字形的特定宽度增量簇的16位偏移量。
4	每个lookupSegment的值是从查找表的开头到一个16位偏移量数组的16位偏移量，段中的每个字形都有一个偏移量。 每个偏移量是从宽度增量簇表的开始到特定宽度增量簇
6	每个lookupSingle 的值是从宽度增量簇表的开头到该字形的特定宽度增量簇的 16 位偏移量。
8	The valueArray is an array of 16-bit offsets, one for each glyph in the trimmed array. Each offset is from the start of the Width Delta Clusters table to the particular width delta cluster for that glyph.